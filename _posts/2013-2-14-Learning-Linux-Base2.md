---
layout: post
title: 《鸟哥的Linux私房菜:基础篇》学习笔记——2.主机规划与磁盘分区
time: 2013-2-14
category: LinuxBase
---


# Linux与硬件的搭配 #

**强调：各个组件或设备在Linux下面都是一个文件。**

##各硬件设备在Linux中的文件名##

**几乎所有的硬件设备文件都在/dev目录内**

|--------------------------------------+------------------------------------------------|
|                设备                  |    设备在Linux内的文件名                       |
|:-------------------------------------|:-----------------------------------------------|
|        IDE硬盘                       |       /dev/hd[a-d]                             |
|        SCSI/SATA/USB硬盘             |       /dev/sd[a-p]                             |
|        U盘                           |       /dev/sd[a-p]与SATA相同                   |
|        软驱                          |       /dev/fd[0-1]                             |
|        打印机                        |       25针:/dev/lp[0-2]   USB:/dev/usb/lp[0-15]|
|        鼠标                          |       USB:/dev/usb/mouse[0-15]  PS2:/dev/psaux |
|        当前CD ROM/DVD ROM            |       /dev/cdrom                               |
|        当前鼠标                      |       /dev/mouse                               |
|        磁带机                        |       IDE:/dev/ht0\\SCSI:/dev/st0              |
|--------------------------------------+------------------------------------------------|

#磁盘分区#

##磁盘连接的方式与设备文件名的关系##

对于老式计算机来说，一般有两个IDE接口，而一个IDE扁平电缆可以连接两个设备，所以一共可以连接4个IDE设备。这两个IDE接口通常称为IDE1(primary)和IDE2(secondary)，而同一根电缆上的两个接口被区分为Master(主设备)与Slave(从设备)。

| IDE1(Priary)         |    /dev/hda     |     /dev/hdb   |
| IDE2(Secondary)      |    /dev/hdc     |     /dev/hdd   |

与IDE不同，SATA/USB/SCSI等磁盘接口都是用SCSI模块来驱动的，但是并没有特定的设备顺序，它们的命名方式是根据**Linux内核检测到磁盘的顺序**

另外，USB只有开机完成后才被系统识别。

##磁盘的组成复习##

每个扇区为512bytes

磁盘的第一个扇区十分重要，其中记录了两个关于磁盘的重要的信息:

- **主引导分区(Master Boot Record,MBR)**:可以安装引导加载程序的地方，有446bytes.
- **分区表**:记录整块硬盘分区的状态,有64bytes.


##磁盘分区表##

柱面是文件系统的最小单位，也是分区的最小单位。

在分区表的64bytes中，总共可以分为4组记录区，每组记录区中记录了该区段的起始与结束的柱面号。这个4组记录区被称为主(Primary)或扩展(Extended)分区，其中，扩展(Extened)分区不能超过1个，也就是说，主分区可以有多个(不超过4个),而不止1个。


**分区命名**

分区的命名方式是在设备文件名后加上数字，其中1-4是保留给Primary或Extended使用的。

例子:

- /dev/hda1
- /dev/hda2

**扩展分区**

磁盘的第一个扇区中的64Bytes只能记录4个分区信息，因此我们可以利用额外的扇区来记录更多的分区信息。扩展分区就是用来做这项工作的。扩展分区的目的是使用额外的扇区来记录信息，**扩展分区本身并不能拿来格式化。**由扩展分区继续分出来的分区称为逻辑分区(logical parition),同时需要注意的是，由于逻辑分区是由扩展分区继续分出来的，所以**逻辑分区可以使用的柱面范围就是扩展分区所设定的范围。**由1-4这四个号码是保留给Primary和Extended所使用的，所以**逻辑分区的设备名称是从5开始的，这很重要！**

**总结**

- 其实所谓的"分区"只是针对第一个扇区中的64bytes的分区表进行设置而已。
- 硬盘默认的分区表仅能写入四组分区信息
- 这四组分区信息我们称为主或扩展分区
- 分区的最小单位是柱面
- 主分区和扩展分区最多可以由四个(硬盘的限制)
- 扩展分区最多只能由一个(OS的限制)
- 逻辑分区是由扩展分区持续切割出来分区
- 能够被格式化后作为数据访问的分区为主分区与逻辑分区。扩展分区无法格式化
- 逻辑分区的数量依OS而不同，在Linux中，IDE硬盘最多有59个逻辑分区(5-63号)，SATA硬盘则有11个逻辑分区(5-15号)
- 分区其实就是以柱面为单位的“连续”磁盘空间。
- 考虑到磁盘的连续性，一般建议将扩展分区的柱面号码分配在最后面的柱面内。


##开机流程与主引导分区##

整个开机流程应该是这样的

- BIOS:开机主动执行的韧体，会认识第一个可开机的设备。(韧体就是写入到硬件上的一个软件程序)
- MBR: 第一个可开机设备的第一个扇区内的主引导分区块，内包含了引导加载程序。
- 引导加载程序(Boot loader):一支可读取内核文件来执行的软件。
- 内核文件: 开始操作系统的功能。

Boot loader是安装在MBR上的一套软件，由于MBD只有446Bytes，所以这个引导加载程序是非常小而完美的。引导加载程序的主要任务如下：

- 提供菜单:用户可以选择不同的开机选项，这也是多重引导的重要功能
- 载入内核文件: 直接指向可开机的程序区段来开始OS
- 转交其他Loader: 将引导加载功能转交给其他loader负责。

**注意:引导加载程序除了可以安装在MBR之外，还可以安装在每个分区的引导扇区**

**总结**

- **每个分区都拥有自己的启动扇区**
- 实际可开机的内核文件是放置到各分区内的
- Loader只会认识自己的系统分区内的可开机内核文件，以及其他loader。
- Loader可直接指向或间接地将管理权转交给另一个管理程序。


