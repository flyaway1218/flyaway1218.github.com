---
layout: post
title: 《Learning Python》学习笔记——21.模块包
time: 2013-3-2
category: Python
---

除了模块名之外，导入也可以指定目录路径。Python代码的目录就成为包，因此，这类导入就称为包导入。事实上，包导入是把计算机上的目录变成另一个Python的命名空间，而属性则对应于目录中所包含的子目录和模块文件。

#包导入基础#
{% highlight python3 %}
#import语句
import dir1.dir2.mod
#from语句
import dir1.dir2.mode from x
{% endhighlight %}
这些语句中的"点号"路径是对应于机器上目录层次的路径，通过这个路径可以获得文件mod.py(或类似文件，扩展名可能会有变化)。也就是说，上面的语句表明了机器上有个目录dir1，而dir1里有子目dir2，而dir2内包含有一个名为mod.py的模块文件。

要记住:**import语句中的目录只能是以点号间隔的变量。**不能在import中使用任何平台特定的路径语法。

##\_\_init\_\_.py包文件##
如果选择使用包导入，就必须多遵循一条约束:**包导入语句的路径中的每个目录内都必须有\_\_init\_\_.py**这个文件，否则导入包会失败。在上面的例子中，dir1和dir2中都必须包含\_\_init\_\_.py这个文件。

\_\_init\_\_.py文件可以是空的也可以是非空的，当有内容时，它就像普通的模块文件，这类文件从某种程度上说就像是Python的一种声明。这些文件可以防止有相同名称的目录不小心出现在模块搜索路径中，而真正所需要的模块却排在其后面。没有这层保护，Python可能会挑选出和程序代码无关的目录，只是因为有一个同名的目录刚好出现在搜索路径上位置较前的目录内。

更通常的情况下，\_\_init\_\_.py文件扮演了包初始钩子、替目录产生模块命名空间以及使用目录导入时实现from \*行为的角色。

**包的初始化**

Python首次导入某个目录时，会自动执行该目录下\_\_init\_\_.py文件中的所有程序代码。因此，这类文件可以作为包内文件所需要的初始化的代码的场所(例如创建需要的数据文件、连接数据库等)。

**模块命名空间的初始化**

在 \_\_init\_\_.py中赋值的变量都会存在于当前目录所创建的模块对象提供的命名空间中。

**from\*语句的行为**

可以在 \_\_init\_\_.py文件内使用\_\_all\_\_列表来定义目录以from \*语句形式导入时，需要导出些什么。在\_\_init\_\_.py文件中，\_\_all\_\_列表是指当包(目录)使用from \*的时候，应该导入的子模块的名称清单。如果没有设定，from\*语句不会自动加载嵌套与该目录内的子模块。

到一个包第一次被导入的时候，路径上每一个目录中的 \_\_init\_\_.py文件都会被执行，实际上，路径中的每一个目录名都会变成赋值了的模块对象的变量，而模块对象的命名空间则是由相应目录内的\_\_init\_\_.py文件中的赋值语句进行初始化的。

##包对应的from语句和import语句##
在导入包的时候，from语句是比较方便的，节省了长路径的繁琐输入，而且当路径发生改变时，主需要修改from语句，而只使用import语句时，则需要修改引用这个包的每一处代码。

#包相对导入#
在包自身的内部，包文件的导入可以使用和外部导入相同的路径语法，但是，它们也可能使用特殊的包内搜索规则来简化导入语句。

##Python3.0中的变化##
对于包的导入，Python3.0引入了两个变化:

- 它修改了导入搜索路径语义，以默认地跳过包自己的目录。导入只会检查搜索路径的其他组件，这叫做"绝对"导入。
- 它扩展了from语句的语法，以允许显示地要求导入只搜索包的目录。这叫做"相对"导入语法。

##相对导入的基础知识##
在Python3.0中，from语句现在可以使用前面的点号(".")来指定，它们需要位于同一包中的模块(所谓的包相对导入)，而不是位于模块导入搜索路径上某处的模块(叫做绝对导入)。也就是说:

- 在Python3.0中，我们可以使用from前面的点号来表示，导入应该相对于外围的包——这样的导入将只是在包的内部搜索，并且不会搜索位于导入搜索路径上(sys.path)上某处的同名模块。直接效果就是包模块覆盖了外部的模块。
- 在Python3.0中，在一个包中导入默认(不是用点号)是绝对的——导入忽略了包含包自身并在sys.path搜索路径上的某处查找。

{% highlight python3 %}
from . import spam
{% endhighlight %}

##相对导入的作用域##

- 相对导入适用于只在包内导入，记住，**这种功能的模块搜索路径修改只应用在位于包内的模块文件中的import语句**
- 相对导入只适用于from语句

##模块查找规则总结##

- 简单模块名通过搜索sys.path路径列表上的每个目录来查找，从左到右进行。这个列表由系统默认设置和用户配置设置组成。
- 在一个包中，常规的import语句使用和其他地方的导入一样的sys.path搜索规则。包中的导入使用from语句以及前面的点号，然而，它是相对于包的；也就是说，只检查包目录，并且不使用常规的sys.path查找。
