---
title: 《Learning Python》学习笔记——4.动态类型简介
time: 2013-1-28
layout: post
category: Python
---

#缺少类型声明语句的情况#

##变量、对象和引用##
在Python中，变量有如下的几个相关概念:

- 变量创建
  一个变量(也就是变量名)，就像a，当代吗第一次给它赋值时就创建了它。之后的赋值将会改变已创建的变量名的值。
- 变量类型
  变量永远不会有任何的和它关联的类型信息或约束。类型的概念是存在于对象中而不是变量名中。变量原本就是通用的，它只是在一个特定的时间点，简单地引用了一个特定的对象而已。
- 变量使用
  当变量出现在表达式中时，它会马上被当前引用的对象所代替，无论这个对象是什么类型。此外，所有的变量必须在其使用前明确地赋值，使用未赋值的变量会产生错误。

当执行到:

{% highlight python %}
a = 3
{% endhighlight %}

这样的代码时，从概念上说，Python将会执行三个不同的步骤去完成这个请求。这些步骤反映了Python语言中所有赋值的操作:

1. 创建一个对象来代表值3
2. 创建一个变量a，如果它还没有创建的话
3. 将变量与新的对象3相连接

从上面的三个步骤可以看出，变量和对象保存在内存中的不同部分，并通过连接相关联。变量总是连接到对象，并且绝不会连接到其他变量上，但是更大的对象可能连接到其他的对象。
在Python中从变量到对象的连接称作引用，也就是说，引用是一种关系，以内存中的指针的形式实现。一旦变量被使用，Python自动跟随这个变量到对象的连接。

**类型属于对象，而不是变量名**

用具体的术语来讲:

- 变量是一个系统表的元素，拥有指向对象的连接的空间
- 对象是分配的一块内存，有足够的空间去表示它们所代表的值
- 引用是自动形成的从变量到对象的指针

从技术上讲，一个对象是具有更复杂的结构的，每一个对象都有两个标准的头部信息:

- 一个类型标识符去标识这个对象的类型
- 一个引用的计数器，用来决定是不是可以回收这个对象

##对象的垃圾收集##

在Python中，每当一个变量名被赋予一个新的对象，之前那个对象占用的空间就会被回收(如果它没有被其他的变量名或对象所引用的话)。这种自动回收对象空间的计数就做垃圾收集。
在Python内部，Python是这样实现这个功能的:它在每个对象中保持了一个计数器，计数器记录了当前指向该对象的引用的数目。一旦(并精确在同一时间)这个计数器被设置为0，这个对象的内存空间就会自动回收。

#共享引用#

{% highlight python %}
a = 3
b = a
{% endhighlight %}

上面代码的实际效果就是变量a和变量b都引用了相同的对象(也就是说，指向了相同的内存)。这在Python中叫做共享引用——多个变量名引用了同一个对象。

{% highlight python %}
a = 3
b = a
a = a+2
{% endhighlight %}

上面代码的最终结果就是，a指向数据为5的内存空间，b指向数据为3的内存空间。事实上，是没有办法修改对象3的值的，之前就提到过，整数是不可变的，因此没有办法在远处修改。在Python中，变量总是一个指向对象的指针，而不是可改变的内存区域的标签:给一个变量赋一个新的值，并不是替换了原始的对象，而是让这个变量去引用完全不同的一个对象。实际的效果就是对一个变量赋值，仅仅会影响那个被赋值的变量。

##共享引用和在原处修改##

但是事实上有一些对象和操作确实会在原处改变对象(例如列表)。

{% highlight python %}
L1=[2,3,4]
L2=L1
L1=24
{% endhighlight %}

上面代码的结果是，L1指向一个值为24的对象，L2仍是引用最初的列表。

{% highlight python %}
L1=[2,3,4]
L2=L1
L1[0]=24
{% endhighlight %}

上面代码的结果是，L1和L2同时引用了值为[24,3,4]的列表。
必须注意上两段代码的不同之处。

如果不想发生以上的情况，那就需要Python拷贝对象，而不是创建引用。
有很多方法可以拷贝一个列表，最常用的方法就是从头到尾的分片。
但是，分片这种方法是不能应用在其他的可变的核心类型上(字典和集合，因为它们不是序列)，复制一个字典或集合应该使用X.copy()方法调用。在标准库中的copy模块有一个通用的复制任意对象类型的调用:

{% highlight python %}
import copy
X = copy.copy(Y)
X = copy.deepcopy(Y)
{% endhighlight %}

在Python中，可变的对象包括了列表、字典以及一些通过class语句定义的对象。

##共享引用和相等##

通常来说，考虑到效率的问题，Python会缓存并复用了小的整数和小的字符串，例如如下的代码:

{% highlight python %}
x = 42
x = 'shrubbery'
{% endhighlight %}

这里的对象42也许并没有被马上回收，而是仍被存在一个系统表中，等待下一次你的代码生成另一个42来重复引用。尽管有这种机制，但是大部分对象都会在不再引用时马上回收。

在Python中有两种"相等":
==操作符:测试两个被引用的对象是否有相同的值
is操作符:检查对象的同一性，就是检查两个变量名是否是指向同一个对象

